<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gregorian Calendar with Solar Calendar Dates</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
    }
    h1, h2 {
      text-align: center;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #ccc;
      margin: 1em auto;
      max-width: 1400px; /* Increased for new format */
    }
    .day, .header {
      background: white;
      padding: 10px;
      text-align: center;
      min-height: 50px;
      font-size: 0.9em; /* Adjusted for more text */
    }
    .header {
      background: #e0e0e0;
      font-weight: bold;
    }
    .month {
      margin-bottom: 2em;
    }
    .today {
      outline: 3px solid #007BFF;
      outline-offset: -3px;
      border-radius: 4px;
      background-color: #e9f5ff;
    }
  </style>
</head>
<body>
<h1>Gregorian Calendar with Solar Calendar Dates</h1>
<div class="controls">
  <label for="year-select">Select Year: </label>
  <input type="number" id="year-select" value="2025" min="1" max="9999" />
</div>
<div id="calendar-container"></div>

<script>
  const customMonths = ["March", "April", "May", "June", "July", "August", "September", "October", "November", "December", "January", "February", "Sol"];
  const weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  const solarWeekdays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
  const msPerDay = 86400000;
  const today = new Date();

  function toLocalISOString(date) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  const todayStr = toLocalISOString(today);

  function getOrdinalSuffix(day) {
    const j = day % 10, k = day % 100;
    if (j == 1 && k != 11) { return "st"; }
    if (j == 2 && k != 12) { return "nd"; }
    if (j == 3 && k != 13) { return "rd"; }
    return "th";
  }

  // --- Functions getSpringEquinox, getFirstMonday, isLeapYear, getSolarDate, clearCalendar remain the same ---
  function getSpringEquinox(year) {
    if (year > 275000 || year < -271000) { throw new RangeError("Invalid time value for year: " + year); }
    if (year < 1583) return new Date(year, 2, 21);
    if (year >= 2044 && (year - 2044) % 4 === 0) return new Date(year, 2, 19);
    return new Date(year, 2, 20);
  }
  function getFirstMonday(date) {
    const day = date.getDay();
    const offset = (day === 1) ? 0 : (8 - day) % 7;
    return new Date(date.getTime() + offset * msPerDay);
  }
  function isLeapYear(year) {
    return (year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0));
  }
  function getSolarDate(date) {
    let solarYear = date.getFullYear();
    let equinoxForYear = getSpringEquinox(solarYear);
    if (date < equinoxForYear) {
      solarYear--;
      equinoxForYear = getSpringEquinox(solarYear);
    }
    let solarYearStart = getFirstMonday(equinoxForYear);
    if (date < solarYearStart) {
      const prevEquinox = getSpringEquinox(solarYear - 1);
      solarYearStart = getFirstMonday(prevEquinox);
    }
    const diffDays = Math.round((date - solarYearStart) / msPerDay);
    if (toLocalISOString(date) === toLocalISOString(equinoxForYear)) { return { year: solarYear, month: "Equinox Day", day: null }; }
    if (isLeapYear(solarYear) && diffDays === 168) { return { year: solarYear, month: "Solstice Day", day: null }; }
    let adjustedDay = diffDays;
    if (isLeapYear(solarYear) && diffDays > 168) adjustedDay--;
    const monthIndex = Math.floor(adjustedDay / 28);
    const day = (adjustedDay % 28) + 1;
    return { year: solarYear, month: customMonths[monthIndex], day };
  }
  function clearCalendar() {
    document.getElementById("calendar-container").innerHTML = "";
  }

  function buildGregorianCalendar(year) {
    const container = document.getElementById("calendar-container");
    clearCalendar();

    try {
      if (year > 275000 || year < -271000) { throw new RangeError("Invalid time value for year: " + year); }

      for (let month = 0; month < 12; month++) {
        const monthStart = new Date(year, month, 1);
        const monthName = monthStart.toLocaleString('default', { month: 'long' });
        const calendar = document.createElement("div");
        calendar.classList.add("month");
        const title = document.createElement("h2");
        title.textContent = `${monthName}`;
        calendar.appendChild(title);
        const grid = document.createElement("div");
        grid.classList.add("calendar");
        weekdays.forEach(day => {
          const header = document.createElement("div");
          header.classList.add("header");
          header.textContent = day;
          grid.appendChild(header);
        });
        const startDay = monthStart.getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        for (let i = 0; i < startDay; i++) {
          const empty = document.createElement("div");
          empty.classList.add("day");
          grid.appendChild(empty);
        }

        for (let day = 1; day <= daysInMonth; day++) {
          const cell = document.createElement("div");
          cell.classList.add("day");
          const gregDate = new Date(year, month, day);
          const dateStr = toLocalISOString(gregDate);
          const solar = getSolarDate(gregDate);

          // Format Current (Gregorian) Date
          const gregWeekdayName = gregDate.toLocaleDateString(undefined, { weekday: 'long' });
          const gregDateStrFormatted = `${gregWeekdayName} ${monthName} ${day}${getOrdinalSuffix(day)}`;

          // Format Opposing (Solar) Date
          let solarDateStr = '';
          if (solar.day) {
            const solarWeekdayName = solarWeekdays[(solar.day - 1) % 7];
            solarDateStr = `${solarWeekdayName} ${solar.month} ${solar.day}${getOrdinalSuffix(solar.day)}`;
          } else {
            solarDateStr = solar.month;
          }
          if (solar.year !== year) {
            solarDateStr += ` (${solar.year})`;
          }

          if (dateStr === todayStr && year === today.getFullYear()) {
            cell.classList.add("today");
          }

          cell.innerHTML = `
            <div style="font-weight: bold; color: grey;">${gregDateStrFormatted}</div>
            <div style="font-weight: bold; color: black;">${solarDateStr}</div>
          `;
          grid.appendChild(cell);
        }
        calendar.appendChild(grid);
        container.appendChild(calendar);
      }
    } catch (error) {
      // Error handling
    }
  }

  document.getElementById("year-select").addEventListener("change", () => {
    const year = parseInt(document.getElementById("year-select").value, 10);
    if (!isNaN(year)) { buildGregorianCalendar(year); }
  });
  buildGregorianCalendar(2025);
</script>
</body>
</html>